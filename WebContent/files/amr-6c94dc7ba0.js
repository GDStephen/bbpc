function E(e){return document.querySelector(e)}function getAudioContext(){return gAudioContext||(gAudioContext=new AudioContext),gAudioContext}function fetchBlob(e,a){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.onload=function(){a(this.response)},o.onerror=function(){alert("Failed to fetch "+e)},o.send()}function readBlob(e,a){var o=new FileReader;o.onload=function(e){var o=new Uint8Array(e.target.result);a(o)},o.readAsArrayBuffer(e)}function fetchAndReadBlob(e,a){fetchBlob(e,function(e){readBlob(e,a)})}function playAmrBlob(e,a){readBlob(e,function(e){playAmrArray(e)})}function convertAudioBlobToAmr(e){readBlob(e,function(e){var a=getAudioContext();a.decodeAudioData(e.buffer,function(e){var a;e.copyFromChannel?(a=new Float32Array(e.length),e.copyFromChannel(a,0,0)):a=e.getChannelData(0);var o=AMR.encode(a,e.sampleRate,7);playAmrArray(o)})})}function playAmrArray(e){var a=AMR.decode(e);return a?void playPcm(a):void alert("Failed to decode!")}function playPcm(e){var a=getAudioContext(),o=a.createBufferSource(),n=a.createBuffer(1,e.length,8e3);if(n.copyToChannel)n.copyToChannel(e,0,0);else{var t=n.getChannelData(0);t.set(e)}o.buffer=n,o.connect(a.destination),o.start()}function convertAmrBlobToWav(e,a){flag?(flag=!1,readBlob(e,function(e){var a=AMR.toWAV(e),o=URL.createObjectURL(new Blob([a],{type:"audio/x-wav"}));urlflag=toHex(a),audio.src=o,audio.onloadedmetadata=audio.onerror=function(){URL.revokeObjectURL(o)},audio.play(),audio.addEventListener("ended",function(){flag=!0;var e=document.body,a=angular.element(e).scope();a.msgVoice=!1,a.$apply()},!1)})):(flag=!1,readBlob(e,function(e){var a=AMR.toWAV(e);if(urlflag==toHex(a)){audio.pause(),audio.startTime=0,flag=!0;var o=document.body,n=angular.element(o).scope();n.msgVoice=!1,n.$apply()}else{var t=URL.createObjectURL(new Blob([a],{type:"audio/x-wav"}));audio.src=t,audio.onloadedmetadata=audio.onerror=function(){URL.revokeObjectURL(t)},audio.play(),audio.addEventListener("ended",function(){flag=!0;var e=document.body,a=angular.element(e).scope();a.msgVoice=!1,a.$apply()},!1)}}))}function playIEMp3(e){null!=lastVoice&&(lastVoice.read=!1),lastVoice=e,e.read=!0;var a=document.getElementById("IEAudio");if(flag){flag=!1;var o=BBGlobal.TFS_URL+e.mp3url+"?name="+e.uuid+".mp3";a.src=o,a.play(),urlflag=o,a.addEventListener("ended",function(){flag=!0,e.read=!1;var a=document.body,o=angular.element(a).scope();o.$apply()},!1)}else{flag=!1;var n=BBGlobal.TFS_URL+e.mp3url+"?name="+e.uuid+".mp3";if(urlflag==n){a.pause(),a.startTime=0,flag=!0,e.read=!1;var t=document.body,r=angular.element(t).scope();r.$apply()}else{var l=BBGlobal.TFS_URL+e.mp3url+"?name="+e.uuid+".mp3";a.src=l,a.play(),a.addEventListener("ended",function(){flag=!0,e.read=!1;var a=document.body,o=angular.element(a).scope();o.$apply()},!1)}}}function toHex(e){for(var a="",o=0;o<e.length;o++){var n=e[o].toString(16);1==n.length&&(n="0"+n),a+=n,o%16==15?a+="\n":o%2==1&&(a+=" ")}return a}var gAudioContext=new AudioContext,flag=!0,urlflag,audio=new Audio,lastVoice=null;